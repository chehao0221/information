name: News Push

on:
  schedule:
    # 這裡的小時已經換算成 UTC (台灣時間 - 8 小時)
    # 台灣時間 08:00, 11:00, 14:00, 17:00, 20:00, 23:00 -> 對應 UTC 00, 03, 06, 09, 12, 15
    - cron: "0 0,3,6,9,12,15 * * *"
    
    # 台灣時間 09:30, 12:30, 15:30, 18:30, 21:30 -> 對應 UTC 01, 04, 07, 10, 13
    - cron: "30 1,4,7,10,13 * * *"
  workflow_dispatch:

permissions:
  contents: write

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
      - [cite_start]uses: actions/checkout@v4 [cite: 1]

      - [cite_start]uses: actions/setup-python@v5 [cite: 1]
        with:
          [cite_start]python-version: "3.11" [cite: 1]

      - [cite_start]run: pip install -r requirements.txt [cite: 1]

      - name: Run news push
        env:
          [cite_start]NEWS_WEBHOOK_TW: ${{ secrets.NEWS_WEBHOOK_TW }} [cite: 2]
          [cite_start]NEWS_WEBHOOK_US: ${{ secrets.NEWS_WEBHOOK_US }} [cite: 2]
          [cite_start]NEWS_WEBHOOK_CRYPTO: ${{ secrets.NEWS_WEBHOOK_CRYPTO }} [cite: 2]
        [cite_start]run: python news_us_tw.py [cite: 2]

      - name: Commit cache
        run: |
          git config user.name "github-actions" [cite: 3]
          git config user.email "actions@github.com" [cite: 3]
          git add data/sent_news.txt [cite: 3]
          git commit -m "update sent news" || true [cite: 3, 4]
          git push || true [cite: 4]
